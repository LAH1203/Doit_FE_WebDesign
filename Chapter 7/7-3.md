# 7-3. 가변 이미지
반응형 웹 사이트의 레이아웃은 브라우저 창의 너비에 따라 화면 요소의 너비도 함께 늘어나거나 줄어드는 것이 기본이다. 그렇다면 애초에 크기가 고정되어 있는 이미지는 어떻게 해야할까? 반응형 웹 요소를 사용하면서 생기는 문제점과 그에 대한 최근의 해결 방법도 살펴보겠다.

<br>

## 가변 이미지를 지정하는 기본 방법
가변 이미지란 화면 너비에 따라 이미지의 너비와 높이가 바뀌는 이미지를 말한다. 이미지는 웹 문서에 삽입할 때부터 이미지의 크기가 정해져 있기 때문에 브라우저 화면이 작아지더라도 이미지의 너빗값은 바뀌지 않아 이미지의 일부가 가려진다.

이미지 같은 멀티미디어 요소들은 웹 문서에 삽입할 때 너비와 높이 값을 지정하게 되어있고, 값을 지정하지 않을 경우 원래 크기대로 삽입된다. `width: 100%`로 지정하면 화면 너빗값에 따라 이미지의 너비가 줄어들거나 늘어나게 되지만, 원래 크기 이상으로 늘어났을 때는 화질이 깨진다.

이미지가 줄어들거나 늘어나는데 원래 이미지의 너빗값 이상으로는 늘어나지 않도록 max-width 속성을 사용한다. 이 속성은 이미지를 감싸고 있는 부모 요소 크기만큼 커지거나 작아지도록 설정한다. min-width 속성을 사용해서 축소되는 너빗값을 제한할 수도 있다.

- `height: auto;`를 사용해 너빗값에 따라 높이(height)도 자동 조절되도록 설정한다.

```css
img {
  max-width: 100%;
  height: auto;
}
```

다음 소스는 너비가 600px인 이미지를 웹 문서에 삽입한 예제이다. 첫 번째 이미지는 화면 너비에 따라 계속 늘어나지만 두 번째 이미지는 원래 이미지 크기보다 늘어나지는 않는다.

```html
<style>
  .img1 { width: 100%; }
  .img2 {
    max-width: 100%;
    height: auto;
  }
</style>
<boby>
  <img src="jump.png" class="img1">
  <img src="jump.png" class="img2">
</body>
```

<br>

## 가변 이미지에서 생길 수 있는 문제점
가변 이미지를 사용하면서 몇 가지 문제가 발견되었다. 가장 큰 문제는 레티나 디스플레이처럼 해상도가 높은 화면의 이미지 처리 문제이다. 사이트 로고나 작은 아이콘 같은 이미지는 큰 문제가 없지만 레티나 급의 이미지를 크기만 줄여서 모바일 기기에 표시한다고 생각해보자. 화면에 보이는 모습은 작아 보여도 이미지 파일을 다운로드하는데 꽤 오랜 시간이 걸릴 것이다.

그렇다면 미디어 쿼리를 이용해 데스크톱에서는 큰 이미지를 표시하고 모바일 기기에서는 작은 이미지를 표시하게 설정하면 어떨까? 이렇게 하더라도 브라우저에서는 일단 사이트에서 사용할 이미지를 '미리 로딩(Preload)'한다. 그 후에 데스크톱에서는 모바일 이미지를 감추고 모바일에서는 데스크톱 이미지를 감추는 방법을 사용한다. 결국 모바일 기기 입장에서는 레티나 이미지 파일까지 로딩하게 된다.

또 다른 문제는 모바일 기기를 가로(Landscape)로 보거나 세로(Portrait)로 볼 때 이미지가 다르게 표시된다는 점이다. 내용이 들어있는 이미지일 경우 모바일 기기에서는 작게 표시되는데 그나마 가로로 놓고 보면 알아보기 쉽지만 세로로 보면 내용을 확인하기 어려울 때가 많다. 이럴 때는 가변 이미지로 만들기보다 세로용 이미지를 따로 만드는 것이 낫다.

<br>

## \<img> 태그의 srcset 속성
이런 문제점을 해결하기 위한 첫 번째 방법은 \<img> 태그의 srcset 속성이다. 이 속성은 기본으로 사용할 이미지 파일 경로를 지정하고, px 너비나 px 밀도에 맞는 여러 이미지를 함께 지정한다.

- srcset 속성은 HTML5에서는 표준 속성으로 채택되지 않았지만, 최신 표준인 HTML5.2에는 표준 속성으로 포함되어있다.
- 가변 이미지와 관련된 정보는 Responsive Images Community Group(http://responsiveimages.org/)에서 확인할 수 있다. 현재까지 인터넷 익스플로러를 제외한 모든 모던 브라우저에서 srcset 속성을 지원하고 있다.

srcset 속성을 사용하는 기본 형식은 다음과 같다.

```html
<img src="기본 이미지" srcset="파일1[, 파일2, 파일3, ...]">
```

### 픽셀 너비 서술자(Pixel Width Descriptor) 함께 사용하기
화면 너비에 따라 이미지 파일을 다르게 지정할 때 '파일 이름, 너비w' 형식을 사용한다. `large.png, 1000w`는 화면 너비가 1000px 이상일 경우 large.png 파일을 표시한다는 의미이다.

예를 들어 다음 소스는 화면 너비가 1024px 이상인 경우 sky-large.png, 640px 이상인 경우 sky-medium.png, 320px 이상인 경우 sky-small.png, 이렇게 3개의 이미지를 제공하고, 뷰포트 크기에 따라 가장 적합한 크기의 이미지가 화면에 표시된다. srcset 속성을 지원하지 않는 브라우저에서는 src 속성에 있는 기본 이미지 sky.png를 표시한다.

```html
<img src="sky.png" srcset="sky-large.png 1024w, sky-medium.png 640w, sky-small.png 320w">
```

### 픽셀 밀도 서술자(Pixel Density Descriptor) 함께 사용하기
화면에 표시되는 객체의 크기는 px 밀도가 증가할수록 더 작아진다. 그래서 기본 px 밀도의 이미지를 1x로 한다면 px 밀도 2x일 때는 이미지를 2배 크게 만든다든지 해서 px 밀도에 따라 이미지를 따로 지정할 수 있다.

```html
<img src="sky.png" srcset="sky-large.png 3x, sky-medium.png 2x, sky-small.png">
```

<br>

## \<picture> 태그
HTML5.1에는 \<picture> 태그가 표준으로 포함되면서 `<picture>` 태그와 `<source>` 태그를 함께 사용해 화면 해상도뿐만 아니라 화면 너비에 따라 다른 이미지 파일을 표시할 수도 있다.

\<source> 태그를 사용하는 방법은 \<video> 태그나 \<audio> 태그에서 \<source> 태그를 사용해 여러 조건의 파일을 따로 지정하는 방법과 비슷하다. 우선 이미지 파일을 지정하는 \<source> 태그에서 사용하는 속성을 알아보겠다.

| 속성 | 설명 |
|---|---|
| media | srcset에 지정한 이미지를 표시하기 위한 조건 |
| sizes | 파일 크기 |
| srcset | 이미지 파일 경로 |
| type | 파일 유형 |

다음 예제는 \<picture> 태그와 \<source> 태그를 이용해 화면 너비에 따라 표시할 이미지를 다르게 지정한 것이다. \<picture> 태그와 \<source> 태그를 지원하지 않는 브라우저에서도 이미지를 표시해야 하기 때문에 \<source> 태그 마지막에는 \<img> 태그를 이용해 기본 이미지를 삽입한다.

```html
<picture>
  <source srcset-"lime-1000.jpg" media="(min-width:1024px)">
  <source srcset-"lime-740.jpg" media="(min-width:768px)">
  <source srcset-"lime-300.jpg" media="(min-width:320px)">
  <img src="lime.jpg" alt="lime" style="max-width:100%">
</picture>
```
